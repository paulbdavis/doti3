#!/usr/bin/env bash

set -x

DMENU="$(which rofi)"
PROMPT="? "
FONT="Ubuntu 18"

mode="dmenu"

while getopts ":rwsPe:p:f:ml:w:h:" opt
do
    case $opt in
        r) mode="run";;
        w) mode="window";;
        s) mode="spotlight";;
        P) mode="prompt";;
        e) message="$OPTARG"
           mode="message";;
        p) PROMPT="$OPTARG";;
        f) FONT="$OPTARG";;
        m) SELECTEDBG="$BG"
           SELECTEDFG="$FG";; # match colors
        l) LINES="$OPTARG";;
        w) width="$OPTARG";;
        h) height="$OPTARG";;
        \?) "Invalid option -$OPTARG";;
        :) "-$OPTARG requires an argument"
    esac
done

run_prompt() {
    $DMENU -font "$FONT" "$@"
}

if [[ "$mode" = "dmenu" ]]
then
    run_prompt -dmenu -p "$PROMPT"
elif [[ "$mode" = "prompt" ]]
then
    run_prompt -separator-style none -dmenu -mesg "$PROMPT" -p '> '
elif [[ "$mode" = "run" ]]
then
    run_prompt -show "run" -fuzzy -display-run "$PROMPT"
elif [[ "$mode" = "spotlight" ]]
then
    run_prompt -modi drun -show drun -fuzzy -display-drun "$PROMPT"
elif [[ "$mode" = "window" ]]
then
    run_prompt -modi window -show window -fuzzy -display-window "$PROMPT"
else
    run_prompt -e "$message" -separator-style none
fi
