#!/usr/bin/env bash

partitions=$(lsblk -p -r --output NAME,MOUNTPOINT | grep ' /' | sed -e 's~/dev/~~' -e 's/ /:/' | sort -u -r)

output=""
short=""

for dp in $partitions
do
    disk="${dp%:*}"
    part="${dp##*:}"
    dfline="$(df -h "$part" 2>/dev/null | tail -1)"
    if [[ -n "$dfline" ]]
    then
        size="$(echo "$dfline" | awk '{print $2}')"
        used="$(echo "$dfline" | awk '{print $3}')"
        percent="$(echo "$dfline" | awk '{print $5}')"
        color="#7f9f7f"
        if [[ ${percent%%%} -gt 85 ]]
        then
            color="#dca3a3"
        elif [[ ${percent%%%} -gt 75 ]]
        then
            color="#c3bf9f"
        fi
        output="${output}<span color='#6c6c6c'>${disk}</span> ${part} <span color='$color'>${used}/${size}</span> "
        short="${short}${part} <span color='$color'>${used}/${size}</span> "
    fi
done



echo "$output"
echo "$short"
